# Game Structure

LootiScript is designed to work seamlessly with the L8B game engine's loop. Understanding the game loop is crucial for creating smooth and responsive games.

## The Game Loop

The game loop is the heart of your game. It runs continuously, updating the game state and drawing the graphics to the screen. L8B handles the complex timing logic for you, providing a consistent 60 FPS (Frames Per Second) experience.

### Lifecycle Functions

L8B looks for specific global functions in your script to hook into the game loop:

1.  **`init()`**: Called once when the game starts. Use this to set up your game state, load assets, and initialize variables.
2.  **`update(dt)`**: Called every frame (typically 60 times per second). Use this for game logic, movement, and collision detection.
3.  **`draw()`**: Called after every update. Use this to render your game to the screen.

```lua
// 1. Initialization
function init()
  player = object
    x = 100,
    y = 100,
    speed = 200
  end
end

// 2. Update Logic
function update(dt)
  // dt is delta time in seconds (e.g., 0.016 for 60fps)
  
  // Move player based on time, not frame rate
  if keyboard.RIGHT then
    player.x += player.speed * dt
  end
end

// 3. Rendering
function draw()
  screen.clear("#000000")
  screen.drawSprite("hero", player.x, player.y)
end
```

## Delta Time (`dt`)

The `update` function receives a `dt` (delta time) parameter. This represents the time in seconds that has passed since the last frame.

**Why use `dt`?**
Using `dt` ensures your game runs at the same speed on all devices, regardless of the frame rate.

-   **Without `dt`**: `x += 5` (Moves 5 pixels per frame. At 30 FPS = 150px/s, at 60 FPS = 300px/s) -> **Inconsistent Speed**
-   **With `dt`**: `x += 300 * dt` (Moves 300 pixels per second, regardless of FPS) -> **Consistent Speed**

## Fixed Update Rate

L8B uses a fixed time step for updates to ensure deterministic physics and logic.

-   **Update Rate**: 60 times per second (default)
-   **Max Frame Skip**: The engine will run `update()` multiple times if the frame rate drops, up to a limit, to catch up.

## State Management

Since LootiScript variables are global by default, managing state is straightforward. However, as your game grows, it's best to organize state into objects.

```lua
// Global Game State
gameState = object
  score = 0,
  level = 1,
  isPaused = 0,
  enemies = {}
end

function update(dt)
  if gameState.isPaused then return end
  
  // Update game logic...
end
```

## Input Handling

Inputs are typically checked inside the `update` loop.

```lua
function update(dt)
  // Check for single key press
  if keyboard.justPressed("SPACE") then
    jump()
  end

  // Check for held key
  if keyboard.isDown("RIGHT") then
    moveRight()
  end
end
```
