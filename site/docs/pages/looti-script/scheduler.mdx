# Time & Scheduler

Managing time is essential in games for animations, cooldowns, and delayed events. LootiScript provides powerful scheduler blocks that integrate directly with the game loop, making time management intuitive and efficient.

## The `after` Block

Execute a block of code once after a specific delay. This is perfect for delayed actions like respawning a player or triggering a cutscene event.

```lua
function playerDie()
  playDeathAnimation()
  
  // Respawn after 3 seconds
  after 3 seconds do
    respawnPlayer()
    resetHealth()
  end
end
```

## The `every` Block

Execute a block of code repeatedly at a specific interval. This is ideal for spawning enemies, regenerating health, or periodic checks.

```lua
// Spawn an enemy every 2 seconds
every 2 seconds do
  spawnEnemy()
end

// Regenerate mana every 500 milliseconds
every 500 milliseconds do
  if mana < MAX_MANA then
    mana += 1
  end
end
```

## The `sleep` Command

Pause the execution of the current function for a specified time. This is incredibly useful for scripting sequences, tutorials, or turn-based logic.

> [!NOTE]
> `sleep` works by suspending the current execution context (like a coroutine). It does **not** block the entire game loop; other game logic and rendering continue to run.

```lua
function playIntro()
  showText("Welcome to the dungeon...")
  sleep 2 seconds
  
  showText("Prepare to fight!")
  sleep 1 second
  
  spawnBoss()
end
```

## Time Units

LootiScript supports natural language time units for better readability.

| Unit | Value (ms) | Example |
|------|------------|---------|
| `millisecond(s)` | 1 | `after 500 milliseconds` |
| `second(s)` | 1000 | `every 1 second` |
| `minute(s)` | 60000 | `after 5 minutes` |
| `hour(s)` | 3600000 | `every 1 hour` |

If no unit is specified, the value is treated as **milliseconds**.

```lua
after 1000 do ... end  // Same as 'after 1 second'
```

## Integration with Game Loop

All scheduler blocks run on the main thread but are managed by the engine's scheduler. They are:
-   **Non-blocking**: The game continues to update and draw while waiting.
-   **Frame-safe**: Callbacks are executed at the start of the frame, ensuring consistency.
-   **Pausable**: (Future feature) Can be paused globally when the game is paused.

## Examples

### Enemy Spawner
```lua
function startWave()
  local count = 0
  
  every 1 second do
    spawnEnemy()
    count += 1
    
    if count >= 10 then
      // Stop this spawner (logic to stop 'every' loop would go here, 
      // typically by using a control variable or cancel token)
      return 
    end
  end
end
```

### Simple Animation
```lua
function flashScreen()
  screen.setColor("#FFFFFF")
  sleep 100 milliseconds
  screen.setColor("#000000")
  sleep 100 milliseconds
  screen.setColor("#FFFFFF")
  sleep 100 milliseconds
  screen.setColor("#000000")
end
```
