# CLI Commands

L8B provides a Command-Line Interface (CLI) for development, building, and deployment of LootiScript games.

## Installation

Install L8B CLI globally:

```bash
pnpm add -g l8b
```

Or use with pnpm dlx (without installing):

```bash
pnpm dlx l8b init my-game
```

## Commands Overview

- [`init`](#init) - Initialize a new project
- [`dev`](#dev) - Start development server with HMR
- [`build`](#build) - Build project for production
- [`preview`](#preview) - Preview production build

## init

Initialize a new LootiScript project.

```bash
l8b init <name>
```

### Options

- `--force`, `-f` - Overwrite existing directory
- `--template`, `-t` - Project template (default: "default")

### Examples

```bash
# Create new project
l8b init my-game

# Overwrite existing directory
l8b init my-game --force
```

### What it creates

```
my-game/
├── src/
│   └── main.loot      # Hello world example file
├── public/
│   ├── sprites/
│   ├── sounds/
│   └── maps/
├── l8b.config.json    # Configuration file
├── package.json       # Package configuration
└── .gitignore         # Git ignore file
```

### Example Code Generated

The `src/main.loot` file will contain a hello world example with wave text animation:

```lua
t = 0

init = function()
  // Initialize game
end

update = function()
  t = t + 1
end

draw = function()
  blink_phase = floor((t / 15) % 2)
  if blink_phase == 0 then
    screen.clear("#0c0c1c")
  else
    screen.clear("#0f102a")
  end

  drawWaveText = function(text, x, y, size, amp, speed, phase, hueShift)
    len = text.length
    total = screen.textWidth(text, size)
    startX = x - total / 2
    advance = 0
    for i = 0 to len - 1 do
      ch = text[i]
      chw = screen.textWidth(ch, size)
      yy = y + cos(t / speed + i * phase) * amp
      xx = startX + advance + chw / 2
      h = (hueShift + i * 18 + t * 2) % 360
      col = "hsl(" + h + ", 85%, 70%)"
      screen.drawText(ch, xx, yy, size, col)
      advance = advance + chw
    end
  end

  cx = 0
  cy = 0
  drawWaveText("this is l8b", cx, cy - 10, 10, 4, 10, 0.4, 0)
  drawWaveText("nice to meet you", cx, cy + 6, 8, 3, 12, 0.38, 120)
end
```

This example demonstrates:
- Wave text animation with rainbow effect
- Blinking background
- Demonstration of functions, loops, and drawing API

## dev

Start development server with Hot Module Replacement (HMR).

```bash
l8b dev [root]
```

### Options

- `root` - Path to project root (default: current directory)
- `--port <number>` - Port for dev server (default: 3000)
- `--host <hostname>` - Expose to network (use `0.0.0.0` to expose)

### Examples

```bash
# Start dev server in current directory
l8b dev

# Start in specific directory
l8b dev ./my-game

# Custom port
l8b dev --port 8080

# Expose to network
l8b dev --host 0.0.0.0

# Custom port and host
l8b dev --port 8080 --host 0.0.0.0

```

### Features

- **Hot Module Replacement** - Code changes automatically recompile and refresh
- **Asset Reloading** - Asset changes automatically reload
- **Error Overlay** - Displays compilation errors in browser
- **Automatic Compilation** - All `.loot` files in `src/` are automatically compiled


## build

Build project for production.

```bash
l8b build [root]
```

### Options

- `root` - Path to project root (default: current directory)
- `--minify` - Minify output (default: true)
- `--no-minify` - Disable minification
- `--sourcemap` - Generate source maps
- `--pwa` - Generate PWA manifest
- `--sw` - Generate service worker
- `--base <url>` - Base URL for assets (default: "")
- `--minifier <name>` - Minifier to use: "esbuild" or "terser" (default: "esbuild")

### Examples

```bash
# Build current directory
l8b build

# Build specific directory
l8b build ./my-game
```

### Output

Build process will generate:

```
.l8b/
├── index.html         # Production HTML
├── runtime.js         # Embedded runtime
├── modules/           # Compiled bytecode
│   ├── game.l8b
│   └── ...
└── assets/            # Copied assets
    ├── sprites/
    ├── sounds/
    └── maps/
```

**Features:**
- Compiled LootiScript bytecode
- Optimized runtime bundle
- Copied assets
- Production-ready HTML
- Environment variables embedded (from `.env` files)

## preview

Preview production build.

```bash
l8b preview [root]
```

### Options

- `root` - Path to project root (default: current directory)
- `--port <number>` - Port for server (default: 3000)
- `--host <hostname>` - Expose to network (use `0.0.0.0` to expose)
- `--outDir <dir>` - Output directory (default: "dist")

### Examples

```bash
# Preview production build
l8b preview

# Custom port
l8b preview --port 8080

# Expose to network
l8b preview --host 0.0.0.0
```

**Note:** Make sure to run `l8b build` before `l8b preview`.

## Project Structure

CLI expects the following project structure:

```
my-game/
├── src/                   # LootiScript files (all .loot files are loaded)
│   ├── game.loot
│   └── scenes/
│       └── menu.loot
├── public/                # Static assets
│   ├── sprites/
│   │   ├── player.png
│   │   └── enemy.png
│   ├── sounds/
│   │   └── jump.wav
│   └── maps/
│       └── level1.json
└── l8b.config.json        # Configuration (optional)
```

## Development Workflow

### 1. Create Project

```bash
pnpm dlx l8b init my-game
cd my-game
pnpm install
```

### 2. Start Development

```bash
l8b dev
```

Open http://localhost:3000 in browser.

### 3. Build for Production

```bash
l8b build
```

### 4. Preview Production Build

```bash
l8b preview
```

## Asset Loading

Assets are automatically detected from `public/`:

```
public/
├── sprites/          → Auto-loaded as sprites
├── sounds/           → Auto-loaded as sounds
├── music/            → Auto-loaded as music
├── maps/             → Auto-loaded as maps
└── fonts/            → Auto-loaded as fonts
```

Access in LootiScript:

```lua
// Sprites auto-loaded
screen.drawSprite("player", 100, 100)

// Sounds auto-loaded
Audio.playSound("jump.wav")

// Maps auto-loaded
screen.drawMap("level1", 0, 0, 800, 600)
```

## Error Handling

CLI provides detailed error messages:

```
✗ Compilation Error

  File: src/game.loot:15:5
  Error: Unexpected token 'end'
  
  Hint: Missing 'then' keyword
```

All errors are displayed with:
- File location
- Line and column number
- Error message
- Helpful hints

## Configuration

See [Configuration File](/configuration/config) for details about `l8b.config.json`.

